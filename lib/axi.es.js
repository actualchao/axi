/* Axi version: 1.0.0 */
function t(t){if("object"==typeof t)return"";const e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t+"");return e?e[1]||"":void 0}function e(t,e){if(e in t.style){const n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return t.style[e]||getComputedStyle(t).getPropertyValue(n)||"0"}return"0"}function n(t,e){const n=Object.assign({},t);for(const i in t)n[i]=e.hasOwnProperty(i)?e[i]:t[i];return n}function i(t,e,n){return Math.min(Math.max(t,e),n)}const s=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"];function r(t,e){return t.getAttribute(e)}function o(t){if(!h(t))return{};const e=t.style.transform||"",n=/(\w+)\(([^)]*)\)/g,i={};let s;for(;s=n.exec(e);)i[s[1]]=s[2];return i}function a(t,e){const n=y(e,"scale")?1:0+function(t){if(y(t,"translate")||"perspective"===t)return"px";if(y(t,"rotate")||y(t,"skew"))return"deg"}(e);return o(t)[e]||n}const u={css:(t,e,n)=>{t.style[e]=n},attribute:(t,e,n)=>{t.setAttribute(e,n)},object:(t,e,n)=>{t[e]=n},transform:(t,e,n,i)=>{i[e]=n;let s="";Object.keys(i).forEach(t=>{s+=`${t}(${i[t]}) `}),t.style.transform=s}},c=t=>t instanceof SVGElement;function h(t){return t.nodeType||c(t)}const d=t=>/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t),l=t=>/^hsl/.test(t),p=t=>/^rgb/.test(t),m=(t,e,n,i)=>`rgba(${t}, ${e}, ${n}, ${i})`,f=t=>{if(d(t))return(t=>{const e=t.replace(/^#([A-F\d])([A-F\d])([A-F\d])$/i,(t,e,n,i)=>e+e+n+n+i+i),n=/^#?([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})$/i.exec(e),[i,s,r,o]=n;return m(parseInt(s,16),parseInt(r,16),parseInt(o,16),1)})(t);if(l(t))return(t=>{const e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),n=parseInt(e[1],10)/360,i=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100,r=e[4]||1;function o(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}let a,u,c;if(0==i)a=u=c=s;else{const t=s<.5?s*(1+i):s+i-s*i,e=2*s-t;a=o(e,t,n+1/3),u=o(e,t,n),c=o(e,t,n-1/3)}return m(255*a,255*u,255*c,r)})(t);if(p(t))return(t=>{const e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+", 1)":t})(t);throw new Error("Please set the correct color(rgb, rgba, hex, hsl).")};function y(t,e){return t.indexOf(e)>-1}function g(t,e){const n=t.x-e.x,i=t.x-e.y;return Math.sqrt(n*n+i*i)}function w(t){const e=[...t.points],n=e.length;return e.reduce((t,i,s)=>{if(s===n-1)return t+0;return t+g(i,e[s+1])},0)}function x(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":!function(t){Math.PI,r(t,"r")}(t);case"rect":!function(t){r(t,"width"),r(t,"height")}(t);case"line":!function(t){g({x:+r(t,"x1"),y:+r(t,"y1")},{x:+r(t,"x2"),y:+r(t,"y2")})}(t);case"polyline":w(t);case"polygon":!function(t){const e=[...t.points];w(t),g(e[0],e[e.length-1])}(t)}}const A=["path","circle","rect","line","polyline","polygon"],b="The motion path node can only be one of (path, circle, rect, line, polyline, polygon).";function v(t){const e=t.tagName.toLowerCase();return A.includes(e)}const E=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},M=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout,C={Sine:()=>t=>1-Math.cos(t*Math.PI/2),Circle:()=>t=>1-Math.sqrt(1-t*t),Back:()=>t=>2.70158*Math.pow(t,3)-1.70158*t*t,Bounce:()=>t=>{let e,n=4;for(;t<((e=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*e-2)/22-t,2)},Quad:()=>t=>Math.pow(t,2),Cubic:()=>t=>Math.pow(t,3),Quart:()=>t=>Math.pow(t,4),Quint:()=>t=>Math.pow(t,5),Expo:()=>t=>Math.pow(2,10*(t-1)),Elastic:(t,e)=>{void 0===t&&(t=1),void 0===e&&(e=.5);let n=i(t,1,10),s=i(e,.1,2);return t=>0===t||1===t?t:-n*Math.pow(2,10*(t-1))*Math.sin((t-1-s/(2*Math.PI)*Math.asin(1/n))*(2*Math.PI)/s)}},O={linear:()=>t=>t};for(const t in C){const e=C[t];O["easeIn"+t]=e,O["easeOut"+t]=(t,n)=>i=>1-e(t,n)(1-i),O["easeInOut"+t]=(t,n)=>i=>i<.5?e(t,n)(2*i)/2:1-e(t,n)(-2*i+2)/2}const T={delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",duration:1e3,autoPlay:!0,loop:!1,direction:"normal",round:!1},L={axiStart:()=>{},axiEnd:()=>{},loopStart:()=>{},loopEnd:()=>{},updateStart:()=>{},updateEnd:()=>{}};function P(t){return"target"!==t&&!T.hasOwnProperty(t)}function k(t){return(t=>y(Object.prototype.toString.call(t),"Object"))(t)&&t.hasOwnProperty("totalLength")}function S(t,e){const n=((k(t)?t.totalLength:t)+"").match(/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g);return{original:t,number:n?+n[0]:0,unit:e}}function F(t){const e=f(t);return{original:e,number:e.match(/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g).map(Number),unit:""}}function I(t,e){return t.getPointAtLength(e>=1?e:0)}function R(t){const e=function(t){let e=t.parentNode;for(;!c(e);)e=e.parentNode;return e}(t),{width:n,height:i}=e.getBoundingClientRect(),s=r(e,"viewBox"),o=s&&s.split(" ").map(t=>+t)||[0,0,n,i];return{el:e,x:o[0],y:o[1],xScale:n/o[2],yScale:i/o[3]}}export default class{constructor(t){this.curTime=0,this.lastTime=0,this.duration=0,this.paused=!0,this.reversed=!1,this.isPausedByBrowserHidden=!1,this.axiStarted=!1,this.axiEnded=!1,this.options=t,this.setAnimationOpts(t),this.setReversed(),this.setRestLoopCount(),this.setHooks(t),this.setAnimationEles(),this.setAnimationKeys(t),this.createAnimations(),this.registerVisibilityEvent(),this.duration=Math.max(...this.animations.map(t=>t.duration))+Math.max(...this.animations.map(t=>t.delay))+Math.max(...this.animations.map(t=>t.endDelay)),this.animationOpts.autoPlay&&(this.newLoop(),this.execute(),this.paused=!1)}registerVisibilityEvent(){document.addEventListener("visibilitychange",()=>{document.hidden&&!this.paused&&(this.isPausedByBrowserHidden=!0,this.pause()),!document.hidden&&this.isPausedByBrowserHidden&&(this.isPausedByBrowserHidden=!1,this.play())})}setAnimationKeys(t){const e=[];for(const n in t)P(n)&&e.push(n);this.animationKeys=e}setAnimationEles(){let{target:t}=this.options;t=Array.isArray(t)?t:[t],this.targets=[].concat(...t.map(t=>"string"==typeof t?Array.from(document.querySelectorAll(t)):t))}setAnimationOpts(t){this.animationOpts=n(T,t),"function"==typeof this.animationOpts.duration&&(this.animationOpts.duration=this.animationOpts.duration())}setReversed(){const{direction:t}=this.animationOpts;this.reversed="reverse"===t}setRestLoopCount(){const{direction:t,loop:e}=this.animationOpts;this.restLoopCount="number"==typeof e?e:e?-1:"alternate"===t?2:1}setHooks(t){this.hooks=n(L,t)}createAnimations(){const t=[].concat(...this.targets.map((t,i,a)=>{const u=h(t)?o(t):{},{delay:c,endDelay:d,easing:l,round:p}=this.animationOpts,m="number"==typeof c?c:c(t,i,a.length),f="number"==typeof d?d:d(t,i,a.length);return this.animationKeys.map(o=>{const c=function(t,n){if(h(t)){if(i=n,s.some(t=>t===i))return"transform";if("transform"!==n&&e(t,n))return"css";if(r(t,n))return"attribute"}var i;if(null!==t[n])return"object"}(t,o);let d={prop:o,easing:l,round:p,delay:m,endDelay:f,duration:this.animationOpts.duration,value:this.options[o]};const y=this.options[o];"object"!=typeof y||k(y)||(d=n(d,y)),d.easing=function(t){const e=t.split("(")[0],n=O[e],i=/\(([^)]+)\)/.exec(t),s=i?i[1].split(",").map(parseFloat):[];return n.apply(null,s)}(d.easing);const g=this.parseTweens(t,c,d,i,a.length);return Object.assign({target:t,tweens:g,type:c,transformCache:u},d)})}));this.animations=t}parseTweens(n,i,s,o,u){const{prop:c,delay:h,endDelay:m,value:f,duration:y}=s,g=function(t,n,i){switch(t){case"transform":return a(n,i);case"css":return e(n,i);case"attribute":return r(n,i);default:return n[i]||0}}(i,n,c),w=t(g),x=Array.isArray(f)?f:[f],A=x.length,b=y/A;return x.map((e,i)=>{const s=d(r=e)||l(r)||p(r);var r;let a,c,f=0===i?g:x[i-1],y=x[i];return"function"==typeof f&&(f=f(n,o,u)),"function"==typeof y&&(y=y(n,o,u)),s?(a=F(f),c=F(e)):(a=S(f,t(f)||w),c=S(y,t(y)||w)),{start:(0===i?h:0)+b*i,end:h+b*(i+1)+(i===A-1?m:0),duration:b,value:e,isPath:k(e),isColor:s,delay:h,from:a,to:c}})}execute(){this.rafId=E(this.animationStep.bind(this))}animationStep(t){const e=this.calcProgressT(t);this.hooks.updateStart(),this.execAnimations(e),this.hooks.updateEnd(),this.checkEnding(e),this.paused||this.execute()}calcProgressT(t){this.startTime||(this.startTime=t);const e=t-this.startTime+this.lastTime;return this.curTime=e,this.reversed?this.duration-e:e}execAnimations(t){this.animations.forEach(e=>{const n=e.tweens.filter(e=>t<=e.end)[0];if(!n)return;const s=e.easing(i(t-n.delay,0,n.duration)/n.duration);let r;r=n.isColor?function(t,e,n){let i=[];for(let s=0;s<t.length;s++)i.push((e[s]-t[s])*n+t[s]);return m(i[0],i[1],i[2],i[3])}(n.from.number,n.to.number,s):n.isPath?function(t,e){const{prop:n,el:i,svg:s,totalLength:r}=t,o=r*e,a=I(i,o),u=I(i,o-1),c=I(i,o+1);switch(n){case"x":return a.x-s.x;case"y":return a.y-s.y;case"angle":return 180*Math.atan2(c.y-u.y,c.x-u.x)/Math.PI}}(n.value,s):(n.to.number-n.from.number)*s+n.from.number,e.round&&!n.isColor&&(r=Math.round(r)),n.to.unit&&(r+=n.to.unit);const o="transform"===e.type?e.transformCache:null;u[e.type](e.target,e.prop,r,o)})}checkEnding(t){(this.reversed?t<=0:t>=this.duration)&&(this.hooks.loopEnd(),"alternate"===this.animationOpts.direction&&(this.reversed=!this.reversed),this.restLoopCount>0||-1===this.restLoopCount?this.newLoop():(this.paused=!0,this.axiEnded=!0,this.hooks.axiEnd()))}pause(){this.paused||(M(this.rafId),this.paused=!0,this.startTime=0,this.lastTime=this.curTime)}play(){this.paused&&(this.paused=!1,this.execute())}restart(){this.setReversed(),this.setRestLoopCount(),this.paused=!1,this.lastTime=0,this.axiStarted=!1,this.axiEnded=!1,this.newLoop(),this.execute()}seek(t){let e=t*this.duration;this.execAnimations(e)}newLoop(){this.restLoopCount>0&&this.restLoopCount--,this.axiStarted||(this.axiStarted=!0,this.axiEnded=!1,this.hooks.axiStart()),this.hooks.loopStart(),this.lastTime=0,this.startTime=0,this.curTime=0}reverse(){this.reversed=!this.reversed,this.restart()}static getMotionPath(t){const e=function(t){if("string"==typeof t){const e=document.querySelectorAll(t);for(const t of e)if(v(t))return t;throw new Error(b)}if(v(t))return t;throw new Error(b)}(t);return t=>({prop:t,el:e,svg:R(e),totalLength:x(e)})}}
/* Contribute to axi: https://github.com/shenyiling/axi */
